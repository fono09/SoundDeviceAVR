#define F_CPU 20000000
#define BAUD 1200
#define SETUBRR (F_CPU/16/BAUD-1)
#define SAMPLES 128
#define TUNES 37

#include<avr/io.h>
#include<util/delay.h>
#include<avr/interrupt.h>
#include<avr/pgmspace.h>

unsigned char* p_tone0;
PROGMEM const unsigned char tone[SAMPLES] = {
	0x80,0x86,0x8c,0x92,0x98,0x9f,0xa5,0xab,0xb0,0xb6,0xbc,0xc1,0xc7,0xcc,0xd1,0xd5,0xda,0xde,0xe2,0xe6,0xea,0xed,0xf0,0xf3,0xf6,0xf8,0xfa,0xfc,0xfd,0xfe,0xff,0xff,0xff,0xff,0xff,0xfe,0xfd,0xfc,0xfa,0xf8,0xf6,0xf3,0xf0,0xed,0xea,0xe6,0xe2,0xde,0xda,0xd5,0xd1,0xcc,0xc7,0xc1,0xbc,0xb6,0xb0,0xab,0xa5,0x9f,0x98,0x92,0x8c,0x86,0x80,0x79,0x73,0x6d,0x67,0x60,0x5a,0x54,0x4f,0x49,0x43,0x3e,0x38,0x33,0x2e,0x2a,0x25,0x21,0x1d,0x19,0x15,0x12,0xf,0xc,0x9,0x7,0x5,0x3,0x2,0x1,0x0,0x0,0x0,0x0,0x0,0x1,0x2,0x3,0x5,0x7,0x9,0xc,0xf,0x12,0x15,0x19,0x1d,0x21,0x25,0x2a,0x2e,0x33,0x38,0x3e,0x43,0x49,0x4f,0x54,0x5a,0x60,0x67,0x6d,0x73,0x79
};
// Tune A2 - A5
unsigned char* p_tune0;
PROGMEM const unsigned char tune[TUNES] = {
	177,167,158,149,140,133,125,118,111,105,99,94,88,83,79,74,70,66,62,59,55,52,49,47,44,41,39,37,35,33,31,29,27,26,24,23,22
};

unsigned char buffer[10];
unsigned char* p_writeBuffer;
unsigned char* p_readBuffer;

ISR(TIMER0_OVF_vect){
}

ISR(TIMER1_COMPA_vect){
}

ISR(TIMER2_COMPA_vect){
	p_tone0++;
	if(p_tone0 - tone > SAMPLES){
		p_tone0 = tone;
	}
	OCR0A = *p_tone0;
}

ISR(USART_RX_vect){
	cli();
	unsigned char us_data = UDR0;
	if(us_data = 0b11000000){

	}else if(us_data = 0b11111111){
			
	}
	sei();
}

unsigned char main(void){

	DDRB = 0xFF;
	DDRD = 0xF0;
	PORTD = 0xFF;

	TCCR0A = 0b10000011;
	TCCR0B = 0b00000001;
	TIMSK0 = 0b00000001;

	TCCR1A = 0b00000000;
	TCCR1B = 0b00001001;
	TIMSK1 = 0b00000010;

	TCCR2A = 0b00000010;
	TCCR2B = 0b00000010;
	TIMSK2 = 0b00000010;

	UBRR0 = (unsigned int)SETUBRR;
	UCSR0B = 0b10111000;
	UCSR0C = 0b00000110;

	p_tone0 = tone;

//	OCR1A = 0x006C;
	OCR2A = 124;

	sei();
	while(1);

};
